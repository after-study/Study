# 📘 CHAPTER 6~7: 불변성과 Copy-on-Write, Defensive Copy

## ✅ 요약 정리

### 📌 불변성과 쓰기

- **읽기(Read)**: 데이터를 가져오기만 하고 바꾸지 않음 → `계산`
    
- **쓰기(Write)**: 데이터를 변경함 → `액션`
    
- 함수형 프로그래밍에서는 **쓰기 동작을 읽기처럼 바꿔서 불변성 유지**
    

---

### 📌 Copy-on-Write (CW)

- **안전지대(Safe Zone)** 내부에서 사용하는 불변 처리 방식
    
- **얕은 복사 후 변경하고 복사본 리턴**
    

```js
var new_array = array.slice();  // 얕은 복사
new_array.push(value);
return new_array;
```

- **장점**
    
    - 빠르고 메모리 효율적
        
    - 내부 데이터를 변경하지 않음
        
- **사용 예**
    
    - 배열 변경, 객체 속성 수정 등
        

---

### 📌 Defensive Copy (DC)

- **신뢰할 수 없는 코드와 주고받는 데이터를 보호**
    
- **깊은 복사**를 사용해서 원본을 보호
    

```js
var copy = deepCopy(data);
```

- **사용 시점**
    
    - 레거시 코드, 외부 API, 이벤트 핸들러 등과 상호작용할 때
        
- **보호 대상**
    
    - 안전지대에 있는 데이터
        

---

### 📌 두 방식 비교

|항목|Copy-on-Write (CW)|Defensive Copy (DC)|
|---|---|---|
|**목적**|불변 데이터 유지|신뢰할 수 없는 코드로부터 보호|
|**위치**|안전지대 내부|안전지대의 입·출력 경계|
|**복사 방식**|얕은 복사 (shallow copy)|깊은 복사 (deep copy)|
|**비용**|낮음|높음|
|**예시 사용**|배열 조작, 객체 속성 변경|외부 API 호출, 레거시 코드 연동|

---

## ❓ 퀴즈

### Q1. 다음 중 **Copy-on-Write**에 해당하는 설명은?

- A. 데이터를 바꾸기 전에 복사본을 만든다. ✅
    
- B. 신뢰할 수 없는 코드와 데이터를 주고받을 때 복사한다.
    
- C. 깊은 복사를 한다.
    
- D. 안전지대 밖으로 데이터를 보낼 때 복사한다.
    

---

### Q2. 다음 중 **방어적 복사(Defensive Copy)** 가 필요한 상황은?

- A. 내부에서 배열을 필터링할 때
    
- B. 서버에서 받은 데이터를 화면에 표시할 때
    
- ✅ C. 외부 모듈에 객체를 전달할 때
    
- D. 전역 상태를 읽을 때
    

---

### Q3. 얕은 복사를 수행하는 JavaScript 메서드는?

- A. `JSON.parse(JSON.stringify(obj))`
    
- B. `deepClone(obj)`
    
- ✅ C. `Object.assign({}, obj)`
    
- D. `structuredClone(obj)`
    

---

### Q4. 다음 코드 중 **방어적 복사**의 예는?

```js
function safeCall(api, data) {
    const copy = deepCopy(data);
    return api(copy);
}
```

- ✅ A. 맞다
    
- B. 아니다
    

---

### Q5. 방어적 복사는 언제 수행하는가? (2개 고르세요)

- ✅ A. 신뢰할 수 없는 코드에 데이터를 보낼 때
    
- B. 배열을 소팅할 때
    
- C. 안전지대 안에서 데이터를 정렬할 때
    
- ✅ D. 신뢰할 수 없는 코드에서 데이터를 받을 때